---
sidebar_label: Testing
title: Testing
---

Code always MUST be covered with appropriate tests. Current implementation uses [Mocha][mocha] and configuration under `.mocharc.json`

To run all available tests defined under `./test/` use:

```bash
npm run test
```

Running tests can be separated by thier type: _unit_, _integration_, _e2e_ by running:

```bash
npm run test:unit
npm run test:integration
```

On top of that tests can run in watch mode(`--watch`):

```bash
npm run test:watch
npm run test:unit:watch
npm run test:integration:watch
```

Keep in mind that having additional `tsconfig.json` file under `./test/tsconfig.json` is necessary:

```json
{
  "extends": "../tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true
  }
}
```

## Visual Studio Code debugging

Additional changes to [`launch.json` Visual Studio Code launch configurations][vscode-debugging] MUST be done to accommodate for `ttypescript` compiler:

![Open launch.json](https://code.visualstudio.com/assets/docs/editor/debugging/launch-configuration.png):

### Running edited file in `--watch` mode:

```json
{
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "mocha:current",
      "program": "${workspaceRoot}/node_modules/.bin/mocha",
      "args": [
        "--config",
        "./.mocharc.json",
        "--s",
        "0",
        "--timeout",
        "999999",
        "--watch",
        "--watch-extensions",
        "ts",
        "${file}"
      ],
      "console": "integratedTerminal",
      "internalConsoleOptions": "neverOpen",
      "runtimeArgs": ["--nolazy"],
      "sourceMaps": true,
      "smartStep": true,
      "env": {
        "NODE_ENV": "test",
        "TS_NODE_PROJECT": "./test/tsconfig.json",
        "TS_NODE_COMPILER": "ttypescript"
      }
    }
  ]
}
```

### Running all files in `--watch` mode:

```json
{
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "mocha:all",
      "program": "${workspaceRoot}/node_modules/.bin/mocha",
      "args": [
        "--require",
        "ts-node/register",
        "--config",
        "./.mocharc.json",
        "--timeout",
        "999999",
        "--watch",
        "--watch-extensions",
        "ts"
      ],
      "console": "integratedTerminal",
      "internalConsoleOptions": "neverOpen",
      "runtimeArgs": ["--nolazy"],
      "sourceMaps": true,
      "smartStep": true,
      "env": {
        "NODE_ENV": "test",
        "TS_NODE_PROJECT": "./test/tsconfig.json",
        "TS_NODE_COMPILER": "ttypescript"
      }
    }
  ]
}
```

## Code coverage

Testing for code coverage is possible with use of [istanbuljs/nyc][nyc] that will enforce [coverage thresholds][nyc-thresholds] - i.e. if thresholds are not met, execution will fail with error:

```bash
error Command failed with exit code 1
```

Settings are stored under `.nycrc.json` file and can be adjusted depending on projects specification.

To run test of coverage use:

```bash
npm run test:coverage
```

To generate basic report that can be consumed by browser use:

```bash
npm run coverage
```

And additional reports for _ci_ or _browser_ can be generated by use of:

```bash
npm run coverage:ci
npm run coverage:report
```

[mocha]: https://mochajs.org/
[vscode-debugging]: https://code.visualstudio.com/docs/editor/debugging
[nyc]: https://github.com/istanbuljs/nyc
[nyc-thresholds]: https://github.com/istanbuljs/nyc#coverage-thresholds
